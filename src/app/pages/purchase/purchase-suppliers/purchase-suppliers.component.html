<div class="suppliers-container">
  <div class="page-header">
    <div class="header-content">
      <h1>Purchase Suppliers</h1>
      <p class="header-subtitle">Manage your supplier network and procurement contacts</p>
    </div>
    <button class="btn-primary btn-lg" (click)="openForm()">
      <i class="fas fa-plus"></i> Add Supplier
    </button>
  </div>

  <!-- Search Section -->
  <div class="search-filter-section">
    <div class="search-box">
      <i class="fas fa-search"></i>
      <input 
        type="text" 
        placeholder="Search by name, email, or phone..." 
        [(ngModel)]="searchQuery"
        class="search-input"
      />
    </div>
    <button class="btn-secondary" (click)="clearFilters()">
      <i class="fas fa-times"></i> Clear
    </button>
  </div>

  <!-- Suppliers Table -->
  <div class="table-container">
    <table class="suppliers-table">
      <thead>
        <tr>
          <th>Supplier Name</th>
          <th>Email</th>
          <th>Phone</th>
          <th>City</th>
          <th>Total Purchased</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let supplier of filteredSuppliers$ | async" class="table-row">
          <td class="name-cell">
            <strong>{{ supplier.name }}</strong>
          </td>
          <td>{{ supplier.email }}</td>
          <td>{{ supplier.phone }}</td>
          <td>{{ supplier.city }}</td>
          <td>
            <strong>₹{{ supplier.totalPurchased | number:'1.0-0' }}</strong>
          </td>
          <td class="actions-cell">
            <button class="btn-icon btn-info" (click)="viewDetails(supplier)" title="View Details">
              <i class="fas fa-eye"></i>
            </button>
            <button class="btn-icon btn-edit" (click)="editSupplier(supplier)" title="Edit">
              <i class="fas fa-edit"></i>
            </button>
            <button class="btn-icon btn-delete" (click)="deleteSupplier(supplier)" title="Delete">
              <i class="fas fa-trash"></i>
            </button>
          </td>
        </tr>
        <tr *ngIf="(filteredSuppliers$ | async)?.length === 0" class="empty-state">
          <td colspan="6">
            <i class="fas fa-inbox"></i>
            <p>No suppliers found. Add your first supplier to get started.</p>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Add/Edit Form Modal -->
  <div class="modal-overlay" *ngIf="showForm" (click)="closeForm()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>{{ isEditMode ? 'Edit Supplier' : 'Add New Supplier' }}</h2>
        <button class="btn-close" (click)="closeForm()">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <form class="supplier-form" (ngSubmit)="saveSupplier()">
        <div class="form-section">
          <h3>Basic Information</h3>
          <div class="form-group">
            <label>Supplier Name *</label>
            <input 
              type="text" 
              [(ngModel)]="formData.name" 
              name="name"
              placeholder="Enter supplier name"
              required
              class="form-input"
              [disabled]="isEditMode"
            />
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Email *</label>
              <input 
                type="email" 
                [(ngModel)]="formData.email" 
                name="email"
                placeholder="Enter email address"
                required
                class="form-input"
              />
            </div>
            <div class="form-group">
              <label>Phone *</label>
              <input 
                type="tel" 
                [(ngModel)]="formData.phone" 
                name="phone"
                placeholder="Enter phone number"
                required
                class="form-input"
              />
            </div>
          </div>
        </div>

        <div class="form-section">
          <h3>Address Information</h3>
          <div class="form-group">
            <label>Address</label>
            <input 
              type="text" 
              [(ngModel)]="formData.address" 
              name="address"
              placeholder="Enter street address"
              class="form-input"
            />
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>City</label>
              <input 
                type="text" 
                [(ngModel)]="formData.city" 
                name="city"
                placeholder="Enter city"
                class="form-input"
              />
            </div>
            <div class="form-group">
              <label>State</label>
              <select 
                [(ngModel)]="formData.state" 
                name="state"
                class="form-input"
              >
                <option value="">Select State</option>
                <option *ngFor="let state of states" [value]="state">{{ state }}</option>
              </select>
            </div>
            <div class="form-group">
              <label>Pincode</label>
              <input 
                type="text" 
                [(ngModel)]="formData.pincode" 
                name="pincode"
                placeholder="Enter pincode"
                class="form-input"
              />
            </div>
          </div>
        </div>

        <div class="form-section">
          <h3>Tax Information</h3>
          <div class="form-group">
            <label>GSTIN</label>
            <input 
              type="text" 
              [(ngModel)]="formData.gstin" 
              name="gstin"
              placeholder="Enter GSTIN (optional)"
              class="form-input"
            />
          </div>
        </div>

        <div class="form-actions">
          <button type="button" class="btn-secondary" (click)="closeForm()">Cancel</button>
          <button type="submit" class="btn-primary">{{ isEditMode ? 'Update' : 'Create' }} Supplier</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Detail Modal -->
  <div class="modal-overlay" *ngIf="showDetailModal && selectedSupplier" (click)="closeDetailModal()">
    <div class="modal-content modal-detail" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Supplier Details</h2>
        <button class="btn-close" (click)="closeDetailModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <div class="detail-content">
        <div class="detail-section">
          <h3>Basic Information</h3>
          <div class="detail-row">
            <span class="detail-label">Name:</span>
            <span class="detail-value">{{ selectedSupplier.name }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Email:</span>
            <span class="detail-value">
              <a [href]="'mailto:' + selectedSupplier.email">{{ selectedSupplier.email }}</a>
            </span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Phone:</span>
            <span class="detail-value">
              <a [href]="'tel:' + selectedSupplier.phone">{{ selectedSupplier.phone }}</a>
            </span>
          </div>
        </div>

        <div class="detail-section">
          <h3>Address</h3>
          <div class="detail-row">
            <span class="detail-label">Street:</span>
            <span class="detail-value">{{ selectedSupplier.address }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">City:</span>
            <span class="detail-value">{{ selectedSupplier.city }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">State:</span>
            <span class="detail-value">{{ selectedSupplier.state }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Pincode:</span>
            <span class="detail-value">{{ selectedSupplier.pincode }}</span>
          </div>
        </div>

        <div class="detail-section">
          <h3>Tax Information</h3>
          <div class="detail-row">
            <span class="detail-label">GSTIN:</span>
            <span class="detail-value">{{ selectedSupplier.gstin || 'Not provided' }}</span>
          </div>
        </div>

        <div class="detail-section">
          <h3>Purchase History</h3>
          <div class="detail-row">
            <span class="detail-label">Total Purchased:</span>
            <span class="detail-value"><strong>₹{{ selectedSupplier.totalPurchased | number:'1.0-0' }}</strong></span>
          </div>
        </div>

        <div class="detail-actions">
          <button class="btn-primary" (click)="editSupplier(selectedSupplier); closeDetailModal()">
            <i class="fas fa-edit"></i> Edit
          </button>
          <button class="btn-secondary" (click)="closeDetailModal()">Close</button>
        </div>
      </div>
    </div>
  </div>
</div>
