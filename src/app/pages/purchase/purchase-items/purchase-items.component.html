<div class="items-container">
  <div class="page-header">
    <div class="header-content">
      <h1>Purchase Items</h1>
      <p class="header-subtitle">Manage your purchase item catalog and supplier inventory</p>
    </div>
    <div class="header-stats">
      <div class="stat-card">
        <span class="stat-label">Total Items</span>
        <span class="stat-value">{{ (items$ | async)?.length || 0 }}</span>
      </div>
      <div class="stat-card">
        <span class="stat-label">Active Items</span>
        <span class="stat-value">{{ getActiveItemsCount() }}</span>
      </div>
      <div class="stat-card">
        <span class="stat-label">Catalog Value</span>
        <span class="stat-value">₹{{ getTotalItemsValue() | number:'1.0-0' }}</span>
      </div>
    </div>
    <button class="btn-primary btn-lg" (click)="openForm()">
      <i class="fas fa-plus"></i> Add Item
    </button>
  </div>

  <!-- Search and Filter Section -->
  <div class="search-filter-section">
    <div class="search-box">
      <i class="fas fa-search"></i>
      <input 
        type="text" 
        placeholder="Search by name, SKU, or description..." 
        [(ngModel)]="searchQuery"
        class="search-input"
      />
    </div>

    <div class="filter-controls">
      <select 
        [(ngModel)]="filterCategory"
        class="filter-select"
      >
        <option value="">All Categories</option>
        <option *ngFor="let cat of getUniqueCategories()" [value]="cat">{{ cat }}</option>
      </select>

      <select 
        [(ngModel)]="filterStatus"
        class="filter-select"
      >
        <option value="">All Status</option>
        <option value="Active">Active</option>
        <option value="Inactive">Inactive</option>
      </select>

      <button class="btn-secondary" (click)="clearFilters()">
        <i class="fas fa-times"></i> Clear
      </button>
    </div>
  </div>

  <!-- Items Table -->
  <div class="table-container">
    <table class="items-table">
      <thead>
        <tr>
          <th>Item Name</th>
          <th>Category</th>
          <th>SKU</th>
          <th>Unit</th>
          <th>Rate</th>
          <th>Tax Rate</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of filteredItems$ | async" class="table-row">
          <td class="name-cell">
            <strong>{{ item.name }}</strong>
          </td>
          <td>
            <span class="category-badge">{{ item.category }}</span>
          </td>
          <td class="sku-cell">{{ item.sku }}</td>
          <td>{{ item.unit }}</td>
          <td class="rate-cell">
            <strong>₹{{ item.rate | number:'1.0-0' }}</strong>
          </td>
          <td>
            <span class="tax-badge">{{ item.taxRate }}%</span>
          </td>
          <td>
            <span class="status-badge" [ngClass]="getStatusClass(item.status)">
              {{ item.status }}
            </span>
          </td>
          <td class="actions-cell">
            <button class="btn-icon btn-info" (click)="viewDetails(item)" title="View Details">
              <i class="fas fa-eye"></i>
            </button>
            <button class="btn-icon btn-edit" (click)="editItem(item)" title="Edit">
              <i class="fas fa-edit"></i>
            </button>
            <button class="btn-icon btn-delete" (click)="deleteItem(item)" title="Delete">
              <i class="fas fa-trash"></i>
            </button>
          </td>
        </tr>
        <tr *ngIf="(filteredItems$ | async)?.length === 0" class="empty-state">
          <td colspan="8">
            <i class="fas fa-inbox"></i>
            <p>No items found. Add your first item to get started.</p>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Add/Edit Form Modal -->
  <div class="modal-overlay" *ngIf="showForm" (click)="closeForm()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>{{ isEditMode ? 'Edit Item' : 'Add New Item' }}</h2>
        <button class="btn-close" (click)="closeForm()">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <form class="item-form" (ngSubmit)="saveItem()">
        <div class="form-section">
          <h3>Basic Information</h3>
          <div class="form-group">
            <label>Item Name *</label>
            <input 
              type="text" 
              [(ngModel)]="formData.name" 
              name="name"
              placeholder="Enter item name"
              required
              class="form-input"
            />
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Category *</label>
              <select 
                [(ngModel)]="formData.category" 
                name="category"
                required
                class="form-input"
              >
                <option value="">Select Category</option>
                <option *ngFor="let cat of categories$ | async" [value]="cat">{{ cat }}</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label>Description</label>
            <textarea 
              [(ngModel)]="formData.description" 
              name="description"
              placeholder="Enter item description"
              rows="3"
              class="form-input"
            ></textarea>
          </div>
        </div>

        <div class="form-section">
          <h3>Pricing & Inventory</h3>
          <div class="form-row">
            <div class="form-group">
              <label>Unit *</label>
              <select 
                [(ngModel)]="formData.unit" 
                name="unit"
                required
                class="form-input"
              >
                <option value="">Select Unit</option>
                <option *ngFor="let unit of units$ | async" [value]="unit">{{ unit }}</option>
              </select>
            </div>
            <div class="form-group">
              <label>Rate (₹) *</label>
              <input 
                type="number" 
                [(ngModel)]="formData.rate" 
                name="rate"
                placeholder="Enter rate"
                required
                min="0"
                step="0.01"
                class="form-input"
              />
            </div>
            <div class="form-group">
              <label>Tax Rate (%)</label>
              <select 
                [(ngModel)]="formData.taxRate" 
                name="taxRate"
                class="form-input"
              >
                <option *ngFor="let tax of taxRates$ | async" [value]="tax">{{ tax }}%</option>
              </select>
            </div>
          </div>
        </div>

        <div class="form-section">
          <h3>Identification</h3>
          <div class="form-row">
            <div class="form-group">
              <label>SKU (Stock Keeping Unit)</label>
              <input 
                type="text" 
                [(ngModel)]="formData.sku" 
                name="sku"
                placeholder="Enter SKU"
                class="form-input"
              />
            </div>
            <div class="form-group">
              <label>HSN Code</label>
              <input 
                type="text" 
                [(ngModel)]="formData.hsn" 
                name="hsn"
                placeholder="Enter HSN code"
                class="form-input"
              />
            </div>
          </div>
        </div>

        <div class="form-section">
          <h3>Status</h3>
          <div class="form-group">
            <label>Status</label>
            <select 
              [(ngModel)]="formData.status" 
              name="status"
              class="form-input"
            >
              <option *ngFor="let status of statusOptions$ | async" [value]="status">{{ status }}</option>
            </select>
          </div>
        </div>

        <div class="form-actions">
          <button type="button" class="btn-secondary" (click)="closeForm()">Cancel</button>
          <button type="submit" class="btn-primary">{{ isEditMode ? 'Update' : 'Create' }} Item</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Detail Modal -->
  <div class="modal-overlay" *ngIf="showDetailModal && selectedItem" (click)="closeDetailModal()">
    <div class="modal-content modal-detail" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Item Details</h2>
        <button class="btn-close" (click)="closeDetailModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <div class="detail-content">
        <div class="detail-section">
          <h3>Basic Information</h3>
          <div class="detail-row">
            <span class="detail-label">Item Name:</span>
            <span class="detail-value">{{ selectedItem.name }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Category:</span>
            <span class="detail-value">
              <span class="category-badge">{{ selectedItem.category }}</span>
            </span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Description:</span>
            <span class="detail-value">{{ selectedItem.description }}</span>
          </div>
        </div>

        <div class="detail-section">
          <h3>Pricing & Tax</h3>
          <div class="detail-row">
            <span class="detail-label">Unit:</span>
            <span class="detail-value">{{ selectedItem.unit }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Rate:</span>
            <span class="detail-value"><strong>₹{{ selectedItem.rate | number:'1.0-0' }}</strong></span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Tax Rate:</span>
            <span class="detail-value">{{ selectedItem.taxRate }}%</span>
          </div>
        </div>

        <div class="detail-section">
          <h3>Identification</h3>
          <div class="detail-row">
            <span class="detail-label">SKU:</span>
            <span class="detail-value">{{ selectedItem.sku }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">HSN Code:</span>
            <span class="detail-value">{{ selectedItem.hsn }}</span>
          </div>
        </div>

        <div class="detail-section">
          <h3>Status & Timestamps</h3>
          <div class="detail-row">
            <span class="detail-label">Status:</span>
            <span class="detail-value">
              <span class="status-badge" [ngClass]="getStatusClass(selectedItem.status)">
                {{ selectedItem.status }}
              </span>
            </span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Created:</span>
            <span class="detail-value">{{ selectedItem.created | date:'short' }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Modified:</span>
            <span class="detail-value">{{ selectedItem.modified | date:'short' }}</span>
          </div>
        </div>

        <div class="detail-actions">
          <button class="btn-primary" (click)="editItem(selectedItem); closeDetailModal()">
            <i class="fas fa-edit"></i> Edit
          </button>
          <button class="btn-secondary" (click)="closeDetailModal()">Close</button>
        </div>
      </div>
    </div>
  </div>
</div>
