<div class="customers-container">
  <div class="page-header">
    <div class="header-content">
      <h1>Sales Customers</h1>
      <p class="header-subtitle">Manage your customer database and track loyalty points</p>
    </div>
    <button class="btn-primary btn-lg" (click)="openForm()">
      <i class="fas fa-plus"></i> Add Customer
    </button>
  </div>

  <!-- Search and Filter Section -->
  <div class="search-filter-section">
    <div class="search-box">
      <i class="fas fa-search"></i>
      <input 
        type="text" 
        placeholder="Search by name, email, or phone..." 
        [(ngModel)]="searchQuery"
        class="search-input"
      />
    </div>

    <div class="filter-controls">
      <input 
        type="email" 
        placeholder="Filter by email..." 
        [(ngModel)]="filterEmail"
        class="filter-input"
      />
      <input 
        type="tel" 
        placeholder="Filter by phone..." 
        [(ngModel)]="filterPhone"
        class="filter-input"
      />
      <button class="btn-secondary" (click)="clearFilters()">
        <i class="fas fa-times"></i> Clear
      </button>
    </div>
  </div>

  <!-- Customers Table -->
  <div class="table-container">
    <table class="customers-table">
      <thead>
        <tr>
          <th>Customer Name</th>
          <th>Email</th>
          <th>Phone</th>
          <th>City</th>
          <th>Loyalty Points</th>
          <th>Total Spent</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let customer of filteredCustomers$ | async" class="table-row">
          <td class="name-cell">
            <strong>{{ customer.name }}</strong>
          </td>
          <td>{{ customer.email }}</td>
          <td>{{ customer.phone }}</td>
          <td>{{ customer.city }}</td>
          <td>
            <span class="loyalty-badge" [ngClass]="'tier-' + getLoyaltyTier(customer.loyaltyPoints).toLowerCase()">
              <i class="fas fa-star"></i> {{ customer.loyaltyPoints }} pts
            </span>
          </td>
          <td>
            <strong>₹{{ customer.totalSpent | number:'1.0-0' }}</strong>
          </td>
          <td class="actions-cell">
            <button class="btn-icon btn-info" (click)="viewDetails(customer)" title="View Details">
              <i class="fas fa-eye"></i>
            </button>
            <button class="btn-icon btn-edit" (click)="editCustomer(customer)" title="Edit">
              <i class="fas fa-edit"></i>
            </button>
            <button class="btn-icon btn-delete" (click)="deleteCustomer(customer)" title="Delete">
              <i class="fas fa-trash"></i>
            </button>
          </td>
        </tr>
        <tr *ngIf="(filteredCustomers$ | async)?.length === 0" class="empty-state">
          <td colspan="7">
            <i class="fas fa-inbox"></i>
            <p>No customers found. Add your first customer to get started.</p>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Add/Edit Form Modal -->
  <div class="modal-overlay" *ngIf="showForm" (click)="closeForm()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>{{ isEditMode ? 'Edit Customer' : 'Add New Customer' }}</h2>
        <button class="btn-close" (click)="closeForm()">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <form class="customer-form" (ngSubmit)="saveCustomer()">
        <div class="form-section">
          <h3>Basic Information</h3>
          <div class="form-group">
            <label>Customer Name *</label>
            <input 
              type="text" 
              [(ngModel)]="formData.name" 
              name="name"
              placeholder="Enter customer name"
              required
              class="form-input"
              [disabled]="isEditMode"
            />
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Email *</label>
              <input 
                type="email" 
                [(ngModel)]="formData.email" 
                name="email"
                placeholder="Enter email address"
                required
                class="form-input"
              />
            </div>
            <div class="form-group">
              <label>Phone *</label>
              <input 
                type="tel" 
                [(ngModel)]="formData.phone" 
                name="phone"
                placeholder="Enter phone number"
                required
                class="form-input"
              />
            </div>
          </div>
        </div>

        <div class="form-section">
          <h3>Address Information</h3>
          <div class="form-group">
            <label>Address</label>
            <input 
              type="text" 
              [(ngModel)]="formData.address" 
              name="address"
              placeholder="Enter street address"
              class="form-input"
            />
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>City</label>
              <input 
                type="text" 
                [(ngModel)]="formData.city" 
                name="city"
                placeholder="Enter city"
                class="form-input"
              />
            </div>
            <div class="form-group">
              <label>State</label>
              <select 
                [(ngModel)]="formData.state" 
                name="state"
                class="form-input"
              >
                <option value="">Select State</option>
                <option *ngFor="let state of states" [value]="state">{{ state }}</option>
              </select>
            </div>
            <div class="form-group">
              <label>Pincode</label>
              <input 
                type="text" 
                [(ngModel)]="formData.pincode" 
                name="pincode"
                placeholder="Enter pincode"
                class="form-input"
              />
            </div>
          </div>
        </div>

        <div class="form-section">
          <h3>Tax Information</h3>
          <div class="form-group">
            <label>GSTIN</label>
            <input 
              type="text" 
              [(ngModel)]="formData.gstin" 
              name="gstin"
              placeholder="Enter GSTIN (optional)"
              class="form-input"
            />
          </div>
        </div>

        <div class="form-actions">
          <button type="button" class="btn-secondary" (click)="closeForm()">Cancel</button>
          <button type="submit" class="btn-primary">{{ isEditMode ? 'Update' : 'Create' }} Customer</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Detail Modal -->
  <div class="modal-overlay" *ngIf="showDetailModal && selectedCustomer" (click)="closeDetailModal()">
    <div class="modal-content modal-detail" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Customer Details</h2>
        <button class="btn-close" (click)="closeDetailModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <div class="detail-content">
        <div class="detail-section">
          <h3>Basic Information</h3>
          <div class="detail-row">
            <span class="detail-label">Name:</span>
            <span class="detail-value">{{ selectedCustomer.name }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Email:</span>
            <span class="detail-value">
              <a [href]="'mailto:' + selectedCustomer.email">{{ selectedCustomer.email }}</a>
            </span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Phone:</span>
            <span class="detail-value">
              <a [href]="'tel:' + selectedCustomer.phone">{{ selectedCustomer.phone }}</a>
            </span>
          </div>
        </div>

        <div class="detail-section">
          <h3>Address</h3>
          <div class="detail-row">
            <span class="detail-label">Street:</span>
            <span class="detail-value">{{ selectedCustomer.address }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">City:</span>
            <span class="detail-value">{{ selectedCustomer.city }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">State:</span>
            <span class="detail-value">{{ selectedCustomer.state }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Pincode:</span>
            <span class="detail-value">{{ selectedCustomer.pincode }}</span>
          </div>
        </div>

        <div class="detail-section">
          <h3>Tax Information</h3>
          <div class="detail-row">
            <span class="detail-label">GSTIN:</span>
            <span class="detail-value">{{ selectedCustomer.gstin || 'Not provided' }}</span>
          </div>
        </div>

        <div class="detail-section">
          <h3>Loyalty Information</h3>
          <div class="detail-row">
            <span class="detail-label">Tier:</span>
            <span class="detail-value">
              <span class="loyalty-badge" [ngClass]="'tier-' + getLoyaltyTier(selectedCustomer.loyaltyPoints).toLowerCase()">
                {{ getLoyaltyTier(selectedCustomer.loyaltyPoints) }}
              </span>
            </span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Loyalty Points:</span>
            <span class="detail-value"><strong>{{ selectedCustomer.loyaltyPoints }}</strong></span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Total Spent:</span>
            <span class="detail-value"><strong>₹{{ selectedCustomer.totalSpent | number:'1.0-0' }}</strong></span>
          </div>
        </div>

        <div class="detail-actions">
          <button class="btn-primary" (click)="editCustomer(selectedCustomer); closeDetailModal()">
            <i class="fas fa-edit"></i> Edit
          </button>
          <button class="btn-secondary" (click)="closeDetailModal()">Close</button>
        </div>
      </div>
    </div>
  </div>
</div>
